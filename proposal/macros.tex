%%% Macros for dissertation proposal + dissertation
%%% Caleb Stanford
%%% January 2021 -- Present

%% Fonts
% For definitions
\newcommand{\defn}[1]{\textbf{\textit{#1}}}
% For traces
\newcommand{\trc}[1]{\mathbf{#1}}
% For tags / alphabet symbols
\newcommand{\tg}[1]{\texttt{#1}}
% For data words
\newcommand{\dw}[1]{\textbf{#1}}
% For data vectors
\newcommand{\dv}[1]{\textbf{#1}}
% For an automaton
\newcommand{\aut}[1]{\mathcal{#1}}

%% Synchronization Schemas paper
\newcommand{\hdrfield}[2]{\left\langle#1: #2\right\rangle}
% Example schema
\renewcommand{\ss}{\ensuremath{{S}}}
% Schema recursive definition cases
\newcommand{\seqleaf}[1]{\ensuremath{\text{Seq}({#1})}}
\newcommand{\relleaf}[1]{\ensuremath{\text{Bag}({#1})}}
\newcommand{\parcomp}[2]{\ensuremath{\text{Par}({#1}, {#2})}}
\newcommand{\parthree}[3]{\ensuremath{\text{Par}({#1}, {#2}, {#3})}}
\newcommand{\hier}[2]{\ensuremath{\text{Sync}({#1}, #2)}}
\newcommand{\keyby}[2]{\ensuremath{\text{PartitionBy}({#1}, #2)}}
% Set of headers for a schema
\newcommand{\headers}{\ensuremath{\mathbf{headers}}}
\newcommand{\prefix}{\preceq}
%% Sec. 2 Series-Parallel Streams
\newcommand{\keyed}[2]{\ensuremath{{#1}\mapsto{#2}}}
\newcommand{\spstype}[2]{\ensuremath{#2[#1]}}
\newcommand{\spsseq}[1]{[#1]}
\newcommand{\spsbag}[1]{\{#1\}}
\newcommand{\spsbagleft}{\{\;} % for splitting across lines
\newcommand{\spsbagright}{\;\}} % for splitting across lines
\newcommand{\spspargen}[1]{\langle #1 \rangle}
\newcommand{\spspar}[2]{\spspargen{#1, #2}}
\newcommand{\spsemp}{\bot}
\newcommand{\tuprestrict}[2]{\ensuremath{{#1}|_{#2}}}
% For schema diagram
\newcommand{\TopSchemaNode}[1]{#1}
\newcommand{\SchemaNode}[2]{node (#2) { \TopSchemaNode{#1} } }
% The KeyBy Node takes 4 arguments:
% 1. The keys
% 2. The node name
% 3. The top node child of the KeyBy Node
% 4. The leaf of the KeyBy Node (to fit around it)
\newcommand{\KeyByNode}[4]{
    \node (#2) [above=1mm of #3.north west, draw=none] {#1};
    \node [draw=black!50, fit={(#3) (#4) (#2)}, double, rounded corners=0] (#2') {}
}
%% Sec. 3 Semantics
% tuples of a header, as a set
\newcommand{\tup}{\mathbf{tup}}
% SPSs of a given type, as a set
\newcommand{\sps}{\ensuremath{\mathbf{sps}}}
% bag of values
\newcommand{\bag}{\mathbf{bag}}
% notation for SPST components
\newcommand{\spstfield}[2]{{#1}.{\mathsf{#2}}}
% semantics for SPST:
% - closed semantics
% - open semantics
% - internal auxiliary semantics (only used in hierarchical case)
\newcommand{\spstsemC}[3]{\llbracket #3 \rrbracket_C (#1, #2)}
\newcommand{\spstsemO}[3]{\llbracket #3 \rrbracket_O (#1, #2)}
\newcommand{\spstsemI}[3]{\llbracket #3 \rrbracket_{Aux} (#1, #2)}
% big-step semantics for SPSQuery
\newcommand{\spsqsem}[3]{#1 \overset{#2}{\rightsquigarrow} #3}
% inference rules
\newcommand{\infrule}[1]{{\sc #1}}

%% Dependence relations from Data-trace types paper
\newcommand{\eq}{\equiv}
\newcommand{\dep}{\ensuremath{\mathrel{\mathrm{D}}}}

%% Static types from Data-trace types paper
% Unit type
\newcommand{\Ut}{\mathtt{Ut}}
% Natural numbers type
\newcommand{\Nat}{\mathbb{N}}
% Bag type
\newcommand{\Bag}{{\textstyle\mathop{\mathsf{Bag}}}}
% The main ones actually used to define graphs
\newcommand{\Ord}{\mathsf{O}}
\newcommand{\Unord}{\mathsf{U}}

%% Data Transducers
% DT elements
\newcommand{\states}{Q}
\newcommand{\tags}{\Sigma}
\newcommand{\update}{\Delta}
\newcommand{\init}{I}
\newcommand{\final}{F}
% To get the entire tuple (so order is tweakable):
\newcommand{\DTtuple}{(\states, \tags, \update, \init, \final)}
\newcommand{\DTtuplesub}[1]{(\states_{#1}, \tags, \update_{#1}, \init_{#1}, \final_{#1})}
\newcommand{\DT}{\aut{A}} % generic name of a data transducer
% \newcommand{\DTI}{\aut{I}} % name for data transducer which is the identity with a certain language.
\newcommand{\size}[1]{\mathsf{size}(#1)} % Size of a DT
\newcommand{\curritem}{\mathsf{cur}} % current data item
% \newcommand{\DF}{G} % Data function
% \newcommand{\DTtype}[2]{#1 \twoheadrightarrow #2} % Type of a DT
% \newcommand{\DFtype}[2]{#1 \Rightarrow #2} % Type of a Data function
% Signature elements
\newcommand{\data}{\mathbb{D}}
\newcommand{\ops}{\textsf{Op}} % operations
\newcommand{\op}{\mathit{op}} % specific operation
\newcommand{\tms}{\textsf{Tm}} % terms
\newcommand{\cdata}{\overline{\data{}}}
% Misc
\newcommand{\pto}{\rightharpoonup} % partial function arrow
\newcommand{\sem}[1]{\llbracket #1 \rrbracket} % semantics
